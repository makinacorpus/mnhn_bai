<% layout('base') -%>

  
<h1><%= __('Gallery') %></h1>

<div class="filter_bar">
    <form action="/gallery" method="post">
        <input type='hidden' name='_csrf' value='<%= _csrf %>'>
        <%= __('Search by category') %><input type="text" name="category">
        <%= __('Free search') %><input type="text" name="freesearch">
        <%= __('Items per page') %><select name="items_per_page">
                                    <option value="20" <% if(items_per_page == 20) {%>selected<% } %>>20</option>
                                    <option value="50" <% if(items_per_page == 50) {%>selected<% } %>>50</option>
                                    <option value="100" <% if(items_per_page == 100) {%>selected<% } %>>100</option>
                                   </select>
        <input type="submit" name="<%= __('Search') %>">
    </form>
</div>
<div class="filter_list">
    <ul>
        <% if(listFilters['category']) {%>
            <li><%= __('Category') %> : <strong><%= listFilters['category'] %></strong><div class="remove_filter" onclick="remove_filter('category')"></div></li>
        <% } %>
        <% if(listFilters['freesearch']) {%>
            <li><%= __('Free search') %> : <strong><%= listFilters['freesearch'] %></strong><div class="remove_filter" onclick="remove_filter('freesearch')"></div></li>
        <% } %>
    </ul>
</div>

<div class="detail_list">
<% listObj.forEach(function(obj, index) {%>

    <div class="detail flip">
        <div class="card"> 
            <div class="face front">
                <a href="/detail/<%= obj.getId() %>">
                    <img src="/data/pied__thumb.png" alt="pied__" />
                </a>
                <% if(!obj.getPublished()) { %>
                    <div class="not_publish"></div>
                <% } %>
            </div>
            <div class="face back">
                <!-- TODO: gif animation             -->
                <img class="animated" src="/img/bone.gif" alt="<%= obj.getTitle() %>" />
            </div> 
        </div>
        <div class="gallery_desc">
            <a href="/detail/<%= obj.getId() %>"><%= obj.getTitle() %></a><br/>
            <span class="text_desc"><%= obj.getShortDesc() %></span>
            <% if (isAdmin) {%>
                <div class="actions">
                    <span class="edit_link"><a href="/admin/edit_object/<%= obj.getId() %>"><img src="/img/icon_edit.png" alt="<%= __('Edit') %>" /></a></span>
                    <span class="del_link"><a href="#" onclick="javascript:delete_obj(<%= obj.getId() %>);"><img src="/img/icon_delete.png" alt="<%= __('Delete') %>" /></a></span>
                </div>
            <% }%>
        </div>
        
    </div>
<% }); %>
</div>

<% if(nb_pages > 1) {%>
    <div class="pagination">
        <%= __('Page') %>
        <% for(i = 1 ; i <= nb_pages; i++) {%>
            <span><a href="/gallery/<%= i %>"><%= i %></a></span>
        <% } %>
    </div>
<% } %>

<script type="text/javascript">
    function remove_filter(filter) {
        window.location.replace("/gallery?remove_filter="+filter);
    }
    
    function delete_obj(objId) {
        if (confirm("<%= __('Are you sure you want to delete this object ?') %>")) { 
            window.location.replace("/admin/delete_object/"+objId);
        }
    }
    
    $(".flip").hover(function(){
        $(this).find(".card").toggleClass("flipped");
        return false;
    });    

</script>